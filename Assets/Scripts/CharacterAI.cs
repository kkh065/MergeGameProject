using UnityEngine;
using UnityEngine.Pool;

public class CharacterAI : MonoBehaviour
{
    float _attackSpeed;
    float _attackCool;
    int _damage = 0;
    int _criticalDamage = 0;
    int _index = 0;

    IObjectPool<ArrowController> _arrowPool;


    public void InitCharacter(int idx, IObjectPool<ArrowController> ArrowPool)
    {
        //해당 캐릭터의 인덱스 설정
        _index = idx;
        _arrowPool = ArrowPool;
        UpdateCharacterState();
    }

    public void UpdateCharacterState()
    {
        //각종 업그레이드들 (공격력,공격속도,치명타확률,치명타배율) 적용
        _damage = GameManager.Instance.EquipArrowData[_index] +
            (Data.Instance.GetUpgradeData(UpgradeType.Gold, 0).Level * (int)Data.Instance.GetUpgradeData(UpgradeType.Gold, 0).Increase) +
            (Data.Instance.GetUpgradeData(UpgradeType.Attack, 0).Level * (int)Data.Instance.GetUpgradeData(UpgradeType.Attack, 0).Increase);

        int a = Data.Instance.GetUpgradeData(UpgradeType.Gold, 3).Level * (int)Data.Instance.GetUpgradeData(UpgradeType.Gold, 3).Increase;
        int b = Data.Instance.GetUpgradeData(UpgradeType.Attack, 3).Level * (int)Data.Instance.GetUpgradeData(UpgradeType.Attack, 3).Increase;
        float c = (a + b + 200) / 100;
        _criticalDamage = (int)((float)_damage * c);
        
        //공격속도

        //치명타확률        
    }

    // Update is called once per frame
    void Update()
    {
        _attackCool += Time.deltaTime;
        if (_attackCool > _attackSpeed && GameManager.Instance.LiveMonsterList.Count > 0)
        {
            Attack();
            _attackCool = 0;
        }
    }

    void Attack()
    {
        //크리티컬 확률 계산 후 크리티컬이면 크리뎀, 아니면 그냥뎀 넣어서 쏘자
        int LastDamage = 0;
        if(true)//크리티컬 계산
        {
            //크리티컬이면
            LastDamage = _criticalDamage;
        }
        else
        {
            LastDamage = _damage;
        }

        ArrowController Arrow = _arrowPool.Get();
        Arrow.transform.position = transform.position;
        Arrow.InitArrow(GameManager.Instance.LiveMonsterList[0], LastDamage, GameManager.Instance.EquipArrowData[_index], _arrowPool);
        //화살생성, 위치초기화, 화살 이닛 실행
    }
}
